var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},view,Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isThemeLoadEnd=!1,t.isResourceLoadEnd=!1,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},t.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},t.prototype.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},t.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.startCreateScene=function(){view=new MainView,this.addChild(view)},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t.prototype.startAnimation=function(e){var t=this,i=new egret.HtmlTextParser,s=e.map(function(e){return i.parse(e)}),n=this.textfield,o=-1,a=function(){o++,o>=s.length&&(o=0);var e=s[o];n.textFlow=e;var i=egret.Tween.get(n);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(a,t)};a()},t.prototype.onButtonClick=function(e){var t=new eui.Panel;t.title="Title",t.horizontalCenter=0,t.verticalCenter=0,this.addChild(t)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function s(s){t.call(i,s,e)}if(RES.hasRes(e)){var n=RES.getRes(e);n?s(n):RES.getResAsync(e,s,this)}else RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Cell=function(){function e(e,t,i,s){this.x=e,this.y=t,this.name=i,this._name=i,this.map=s,1===i.length&&(this.type="normal",this._type="normal")}return e.prototype.tryMoveGetAcitons=function(e,t){var i;switch(e){case"left":i=this.map.getCellByYX(this.y,this.x-1);break;case"right":i=this.map.getCellByYX(this.y,this.x+1);break;case"top":i=this.map.getCellByYX(this.y-1,this.x);break;case"bottom":i=this.map.getCellByYX(this.y+1,this.x)}return i?this.map.exchangeCellsAcitons(this,i,t):[]},e.prototype.tryMagic=function(e){switch(e){case"left":case"right":return this.type="row",this._type="row",{action:"magic",magic:{type:"row",y:this.y,x:this.x}};case"top":case"bottom":return this.type="column",this._type="column",{action:"magic",magic:{type:"column",y:this.y,x:this.x}}}},e}();__reflect(Cell.prototype,"Cell");var CellPos=function(){function e(e){this.data={},this.holls={},this.type=e}return e.prototype.addYX=function(e,t){"x"===this.type&&(this.data["_"+t]||(this.data["_"+t]=[]),-1===this.data["_"+t].indexOf(e)&&this.data["_"+t].push(e))},e.prototype.keyToLine=function(e){return+e.slice(1)},e.prototype.getMaxByLine=function(e){return this.data["_"+e]?Math.max.apply(null,this.data["_"+e]):void 0},e.prototype.getAllCellCountByLine=function(e){for(var t=this.getMaxByLine(e),i=[],s=-this.data["_"+e].length;t>s;s++)if(!this.isContain(e,s)){var n=this.getMaxThenNumCount(e,s);this.isHoll(e,n+s)||i.push({y:s,x:e,count:this.getMaxThenNumCount(e,s)})}return i},e.prototype.isContain=function(e,t){return this.data["_"+e].indexOf(t)>-1},e.prototype.isHoll=function(e,t){return this.holls["_"+e]?this.holls["_"+e].indexOf(t)>-1:!1},e.prototype.getMaxThenNumCount=function(e,t){return this.data["_"+e].filter(function(e){return e>t}).length},e.prototype.getXCellHolls=function(e){var t=this;e.holls.forEach(function(e){t.holls["_"+e.x]||(t.holls["_"+e.x]=[]),t.holls["_"+e.x].push(e.y)})},e}();__reflect(CellPos.prototype,"CellPos");var CellSet=function(){function e(e){this.data={},this.r=[],this.b=[],this.map=e}return e.prototype.addCell=function(e){var t=e.y,i=e.x;this.data[t+"_"+i]||(this.data[t+"_"+i]=e)},e.prototype.removeCellYX=function(e,t){return this.data[e+"_"+t]?(this.data[e+"_"+t]=null,!0):!1},e.prototype.getCellByYX=function(e,t){return this.data[e+"_"+t]?this.data[e+"_"+t]:null},e.prototype.isEmpty=function(){return 0===Object.keys(this.data).length},e.prototype.getAllCellsYXArray=function(){var e=[];for(var t in this.data){var i=this.data[t];e.push({y:i.y,x:i.x})}return e},e.prototype.getAllCells=function(){var e=[];for(var t in this.data){var i=this.data[t];e.push(i)}return e},e.prototype.createXCellPos=function(){this.XPos=new CellPos("x");for(var e in this.data){var t=this.data[e];t&&this.XPos.addYX(t.y,t.x)}return this.XPos.getXCellHolls(this.map),this.XPos},e.prototype.getYCellPos=function(){if(!this.YPos){this.YPos=new CellPos("x");for(var e in this.data){var t=this.data[e];t&&this.YPos.addYX(t.y,t.x)}}return this.YPos},e.prototype.getEachCount=function(e){var t={};for(var i in this.data){var s=this.data[i];t[s.name]||(t[s.name]=0),t[s.name]++}if(e)for(var i in e){var s=e[i];t[s.name]||(t[s.name]=0),t[s.name]--}return t},e.prototype.specialBoom=function(){var e,e,e,t=this,i=[],s=function(s){var o=n.data[s];switch(o.type){case"column":e=n.map.getColumnCellsByX(o.x),e.forEach(function(e){e!==o&&t.addCell(e)}),o.type="...",i.push({type:"column",x:o.x,y:o.y});break;case"row":e=n.map.getRowCellsByY(o.y),e.forEach(function(e){e!==o&&t.addCell(e)}),o.type="...",i.push({type:"row",y:o.y,x:o.x});break;case"cross":e=n.map.getCrossCellsByYX(o.y,o.x),e.forEach(function(e){return t.addCell(e)}),o.type="...",i.push({type:"cross",y:o.y,x:o.x})}},n=this;for(var o in this.data)s(o);return i},e.prototype.addSpecialCell=function(e){var t=this,i=[];return e.forEach(function(e){switch(e.type){case"row_4":case"row_5":var s=t.map.getCellByYX(e.middle.y,e.middle.x);t.removeCellYX(s.y,s.x)&&(s.type="column",i.push({type:"column",y:s.y,x:s.x,name:s.name}));break;case"column_4":case"column_5":var s=t.map.getCellByYX(e.middle.y,e.middle.x);t.removeCellYX(s.y,s.x)&&(s.type="row",i.push({type:"row",y:s.y,x:s.x,name:s.name}));break;case"3_3":case"3_4":case"3_5":case"4_3":case"5_3":var s=t.map.getCellByYX(e.middle.y,e.middle.x);t.removeCellYX(s.y,s.x)&&(s.type="cross",i.push({type:"cross",y:s.y,x:s.x,name:s.name}))}}),this.createXCellPos(),i},e.prototype.getBoomtypes=function(e,t){var i=this,s=[],n=[],o=[],a=this.b,r=this.r;return r.forEach(function(h){function l(e,t){return e&&p===e.name&&-1!==t.indexOf(e)}if(-1===n.indexOf(h)){var u=h.x,c=h.y,p=h.name,y=i.map.getCellByYX(c,u+1),d=i.map.getCellByYX(c,u+2),m=i.map.getCellByYX(c-1,u),g=i.map.getCellByYX(c-1,u+1),x=i.map.getCellByYX(c-1,u+2),C=i.map.getCellByYX(c-2,u),f=i.map.getCellByYX(c-2,u+1),w=i.map.getCellByYX(c-2,u+2);if(l(y,r))if(l(d,r))if(l(d,a))s.push({type:"5_3",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c,x:u+3},{y:c,x:u+4},{y:c+1,x:u+2},{y:c+2,x:u+2}],middle:{y:c,x:u+2}}),n.push(h,y,d),o.push(d);else if(l(w,a))s.push({type:"5_3",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c,x:u+3},{y:c,x:u+4},{y:c-1,x:u+2},{y:c-2,x:u+2}],middle:{y:c,x:u+2}}),n.push(h,y,d),o.push(w);else{var v={y:c,x:u+2};e&&t&&(v=[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c,x:u+3},{y:c,x:u+4}].filter(function(i){return i.y===e.y&&i.x===e.x||i.y===t.y&&i.x===t.x})[0]),s.push({type:"row_5",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c,x:u+3},{y:c,x:u+4}],middle:v}),n.push(h,y,d)}else if(l(y,a))s.push({type:"4_3",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c,x:u+3},{y:c+1,x:u+1},{y:c+2,x:u+1}],middle:{y:c,x:u+1}}),n.push(h,y),o.push(y);else if(l(f,a))s.push({type:"4_3",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c,x:u+3},{y:c-1,x:u+1},{y:c-2,x:u+1}],middle:{y:c,x:u+1}}),n.push(h,y),o.push(f);else if(l(d,a))s.push({type:"4_3",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c,x:u+3},{y:c+1,x:u+2},{y:c+2,x:u+2}],middle:{y:c,x:u+2}}),n.push(h,y),o.push(d);else if(l(w,a))s.push({type:"4_3",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c,x:u+3},{y:c-1,x:u+2},{y:c-2,x:u+2}],middle:{y:c,x:u+2}}),n.push(h,y),o.push(w);else{var _=~~(2*Math.random())+1,v={y:c,x:u+_};e&&t&&(v=[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c,x:u+3}].filter(function(i){return i.y===e.y&&i.x===e.x||i.y===t.y&&i.x===t.x})[0]),s.push({type:"row_4",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c,x:u+3}],middle:v}),n.push(h,y)}else{var E=l(C,a),T=l(m,a),R=l(h,a),V=l(f,a),M=l(g,a),S=l(y,a),b=l(w,a),L=l(x,a),B=l(d,a);E&&T&&R?(s.push({type:"3_5",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c-2,x:u},{y:c-1,x:u},{y:c+1,x:u},{y:c+2,x:u}],middle:{y:c,x:u}}),n.push(h),o.push(C,m,h)):E&&T?(s.push({type:"3_4",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c-2,x:u},{y:c-1,x:u},{y:c+1,x:u}],middle:{y:c,x:u}}),n.push(h),o.push(C,m)):R&&T?(s.push({type:"3_4",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c+2,x:u},{y:c-1,x:u},{y:c+1,x:u}],middle:{y:c,x:u}}),n.push(h),o.push(m,h)):E?(s.push({type:"3_3",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c-2,x:u},{y:c-1,x:u}],middle:{y:c,x:u}}),n.push(h),o.push(C)):T?(s.push({type:"3_3",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c-1,x:u},{y:c+1,x:u}],middle:{y:c,x:u}}),n.push(h),o.push(m)):R?(s.push({type:"3_3",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c+1,x:u},{y:c+2,x:u}],middle:{y:c,x:u}}),n.push(h),o.push(h)):V?(s.push({type:"3_3",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c-2,x:u+1},{y:c-1,x:u+1}],middle:{y:c,x:u+1}}),n.push(h),o.push(f)):M?(s.push({type:"3_3",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c-1,x:u+1},{y:c+1,x:u+1}],middle:{y:c,x:u+1}}),n.push(h),o.push(g)):S?(s.push({type:"3_3",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c+1,x:u+1},{y:c+2,x:u+1}],middle:{y:c,x:u+1}}),n.push(h),o.push(y)):b&&L&&B?(s.push({type:"3_5",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c-2,x:u+2},{y:c-1,x:u+2},{y:c+1,x:u+2},{y:c+2,x:u+2}],middle:{y:c,x:u+2}}),n.push(h),o.push(w,x,d)):b&&L?(s.push({type:"3_4",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c-2,x:u+2},{y:c-1,x:u+2},{y:c+1,x:u+2}],middle:{y:c,x:u+2}}),n.push(h),o.push(f,g)):L&&B?(s.push({type:"3_4",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c+2,x:u+2},{y:c-1,x:u+2},{y:c+1,x:u+2}],middle:{y:c,x:u+2}}),n.push(h),o.push(x,d)):b?(s.push({type:"3_3",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c-2,x:u+2},{y:c-1,x:u+2}],middle:{y:c,x:u+2}}),n.push(h),o.push(w)):L?(s.push({type:"3_3",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c-1,x:u+2},{y:c+1,x:u+2}],middle:{y:c,x:u+2}}),n.push(h),o.push(x)):B?(s.push({type:"3_3",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2},{y:c-1,x:u+2},{y:c-2,x:u+2}],middle:{y:c,x:u+2}}),n.push(h),o.push(d)):(s.push({type:"row_3",poses:[{y:c,x:u},{y:c,x:u+1},{y:c,x:u+2}]}),n.push(h))}}}),a.forEach(function(n){function r(e,t){return e&&u===e.name&&-1!==t.indexOf(e)}if(-1===o.indexOf(n)){var h=n.x,l=n.y,u=n.name,c=i.map.getCellByYX(l+1,h),p=i.map.getCellByYX(l+2,h);if(r(c,a))if(r(p,a)){var y={y:l+2,x:h};e&&t&&(y=[{y:l,x:h},{y:l+1,x:h},{y:l+2,x:h},{y:l+3,x:h},{y:l+4,x:h}].filter(function(i){return i.y===e.y&&i.x===e.x||i.y===t.y&&i.x===t.x})[0]),s.push({type:"column_5",poses:[{y:l,x:h},{y:l+1,x:h},{y:l+2,x:h},{y:l+3,x:h},{y:l+4,x:h}],middle:y}),o.push(n,c,p)}else{var d=~~(2*Math.random())+1,y={y:l+d,x:h};e&&t&&(y=[{y:l,x:h},{y:l+1,x:h},{y:l+2,x:h},{y:l+3,x:h}].filter(function(i){return i.y===e.y&&i.x===e.x||i.y===t.y&&i.x===t.x})[0]),s.push({type:"column_4",poses:[{y:l,x:h},{y:l+1,x:h},{y:l+2,x:h},{y:l+3,x:h}],middle:y}),o.push(n,c)}else s.push({type:"column_3",poses:[{y:l,x:h},{y:l+1,x:h},{y:l+2,x:h}]}),o.push(n)}}),s},e}();__reflect(CellSet.prototype,"CellSet");var Map=function(){function e(e){this.data={},this.holls=[],this.dataArr=[],this.mission=e}return e.prototype.addCell=function(e,t,i){1===i.length?(this.data[e+"_"+t]=new Cell(t,e,i,this),this.dataArr.push(this.data[e+"_"+t])):""===i&&this.holls.push({y:e,x:t})},e.prototype.getCellByYX=function(e,t){var i=this.data[e+"_"+t];return i?i:null},e.prototype.getColumnCellsByX=function(e){var t=[];for(var i in this.data)i.split("_")[1]===e.toString()&&t.push(this.data[i]);return t},e.prototype.getRowCellsByY=function(e){var t=[];for(var i in this.data)i.split("_")[0]===e.toString()&&t.push(this.data[i]);return t},e.prototype.getCrossCellsByYX=function(e,t){var i=[];for(var s in this.data){var n=+s.split("_")[0],o=+s.split("_")[1];n-e===-2||n-e===2?o===t&&i.push(this.data[s]):n-e===-1||n-e===1?(o-t===1||o-t===0||o-t===-1)&&i.push(this.data[s]):n===e&&(o-t===2||o-t===1||o-t===-1||o-t===-2)&&i.push(this.data[s])}return i},e.prototype.log=function(){console.table(this.data)},e.prototype.hammerActions=function(e){var t=[],i=new CellSet(this);return i.addCell(e),t.push.apply(t,this.dealWillRemoveCellSet(i)),t},e.prototype.dealWillRemoveCellSet=function(e,t,i){for(var s=[];!e.isEmpty();){var n=e.getBoomtypes(t,i),o=this.getRequirementData(this.mission.requireType,e);s.push({action:"boom",data:e.createXCellPos().data,requirement:o});for(var a=e.specialBoom();a.length>0;)o=this.getRequirementData(this.mission.requireType,e,o),s.push({action:"boom",data:e.createXCellPos().data,requirement:o,specialBoom:a}),a=e.specialBoom();var r=e.addSpecialCell(n);r.length>0&&s.push({action:"specialCells",specialCells:r}),s.push(this.removeCells(e)),e=this.check(),t=null,i=null}return s},e.prototype.exchangeCellsAcitons=function(e,t,i){var s=[];s.push(this.exchangeCells(e,t));var n;return n=this.check(),n.isEmpty()?i||s.push({action:"wait",second:200},this.exchangeCells(e,t)):(this.mission.dealLimitCount(),s.push.apply(s,this.dealWillRemoveCellSet(n,e,t))),s},e.prototype.check=function(){var e=new CellSet(this);for(var t in this.data){var i=this.data[t],s=this.getCellByYX(i.y+1,i.x),n=this.getCellByYX(i.y+2,i.x);s&&n&&i.name===s.name&&i.name===n.name&&(e.addCell(i),e.addCell(s),e.addCell(n),e.b.push(i));var o=this.getCellByYX(i.y,i.x+1),a=this.getCellByYX(i.y,i.x+2);o&&a&&i.name===o.name&&i.name===a.name&&(e.addCell(i),e.addCell(o),e.addCell(a),e.r.push(i))}return e},e.prototype.exchangeCells=function(e,t){var i=e.name;e.name=t.name,t.name=i;var s=e.type;return e.type=t.type,t.type=s,{action:"exchange",cell1:{x:e.x,y:e.y},cell2:{x:t.x,y:t.y}}},e.prototype.removeCells=function(e){var t=this,i=[],s=[],n=e.createXCellPos();for(var o in n.data){var a=(n.data[o].length,n.keyToLine(o)),r=(n.getMaxByLine(a),n.getAllCellCountByLine(a));s.push.apply(s,r),r.forEach(function(e){var s,n=e.x,o=e.y,a=e.count,r="normal",h=t.getCellByYX(o+a,n);t.getCellByYX(o,n)?(s=t.getCellByYX(o,n).name,r=t.getCellByYX(o,n).type):(s=t.getNewCellName(),i.push({name:s,x:n,y:o})),h._name=s,h._type=r}),r.forEach(function(e){var i=e.x,s=e.y,n=e.count,o=t.getCellByYX(s+n,i);o.name=o._name,o.type=o._type})}return{action:"createCells",newCells:i,downCells:s}},e.prototype.getNewCellName=function(){var e=~~(Math.random()*this.mission.names.length);return this.mission.names[e]},e.prototype.getRequirementData=function(e,t,i){var s;switch(e){case"eachCount":s=this.mission.dealrequireEachCount(t.getEachCount(i))}return s},e}();__reflect(Map.prototype,"Map");var Mission=function(){function e(e){this.stage="playing",this.map=new Map(this),this.missionMapData=e.map,this.widthCount=e.map[0].length,this.heightCount=e.map.length,this.names=e.names,this._initCells(),e.requirement&&this._initRequirement(e.requirement),e.limit&&this._initLimit(e.limit)}return e.prototype._initCells=function(){var e=this;this.missionMapData.forEach(function(t,i){t.forEach(function(t,s){e.map.addCell(i,s,t)})})},e.prototype._initRequirement=function(e){switch(this.requireType=e.type,e.type){case"eachCount":this.requireMentEachCount=JSON.parse(JSON.stringify(e.eachCount))}},e.prototype._initLimit=function(e){switch(this.limitType=e.type,e.type){case"count":this.limitCount=e.count}},e.prototype.dealrequireEachCount=function(e){var t=this.requireMentEachCount;for(var i in e)t[i]&&(t[i]-=e[i],t[i]<0&&(t[i]=0));return Object.keys(t).every(function(e){return 0===t[e]})&&(this.stage="win"),JSON.parse(JSON.stringify(t))},e.prototype.dealLimitCount=function(){"count"===this.limitType&&"playing"===this.stage&&(this.limitCount>1?this.limitCount--:(this.limitCount=0,this.stage="dead"))},e.prototype.toolIncreaseLimitCount=function(){this.limitCount+=5},e}();__reflect(Mission.prototype,"Mission");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var ConstantData=function(){function e(){}return e.getStageWidth=function(){return egret.MainContext.instance.stage.stageWidth},e.getStageHeight=function(){return egret.MainContext.instance.stage.stageHeight},e}();ConstantData.TextColors={roomBlue:7194537,white:16777215,milkWhite:16511407,grayWhite:13547170,yellow:16776960,lightYellow:16765813,orangeYellow:16750848,orange:16764489,red:15799040,green:58624,lgreen:6474584,blue:1742039,grayBlue:3101047,purple:15284466,pink:16724016,black:3026221,golden:16766720},ConstantData.LabelFontSize={miniSize:12,smallSize:14,middleSize:18,normalSize:24,bigSize:36},ConstantData.frame=60,ConstantData.CONTENT_WIDTH=640,ConstantData.CONTENT_HEIGHT=1136,__reflect(ConstantData.prototype,"ConstantData");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,s){function n(e){t.call(s,e)}function o(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(s))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Lobby=function(e){function t(t,i){var s=e.call(this)||this;return s.missionData=t,s.missionCount=t.length,s.width=ConstantData.CONTENT_WIDTH,s.height=ConstantData.CONTENT_HEIGHT,s.mainView=i,s.initBtns(),s}return __extends(t,e),t.prototype.initBtns=function(){var e=this;this.myGroup=new eui.Group,this.addChild(this.myGroup);var t=new eui.TileLayout;t.horizontalGap=10,t.verticalGap=10,t.columnAlign=eui.ColumnAlign.JUSTIFY_USING_WIDTH,t.rowAlign=eui.RowAlign.JUSTIFY_USING_HEIGHT,t.paddingTop=30,t.paddingRight=30,t.paddingLeft=30,t.paddingBottom=10,t.requestedColumnCount=2,this.myGroup.layout=t;for(var i=function(t){var i=new eui.Button;i.label="第"+(t+1)+"关",i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.mainView.removeChild(e),e.mainView.addChild(e.mainView.allMissionsView),e.mainView.allMissionsView.toMission(t)},s),s.myGroup.addChild(i)},s=this,n=0;n<this.missionCount;n++)i(n)},t}(egret.DisplayObjectContainer);__reflect(Lobby.prototype,"Lobby");var MainView=function(e){function t(){var t=e.call(this)||this,i="src/data/MissionData.json",s=new egret.HttpRequest,n=function(e){switch(e.type){case egret.Event.COMPLETE:var i=e.currentTarget,s=JSON.parse(i.response);t.lobby=new Lobby(s,t),t.allMissionsView=new AllMissionsView(s,t),t.addChild(t.lobby);break;case egret.IOErrorEvent.IO_ERROR:console.log("respHandler io error")}},o=function(e){console.log("progress:",e.bytesLoaded,e.bytesTotal)};return s.once(egret.Event.COMPLETE,n,null),s.once(egret.IOErrorEvent.IO_ERROR,n,null),s.once(egret.ProgressEvent.PROGRESS,o,null),s.open(i,egret.HttpMethod.GET),s.send(),t}return __extends(t,e),t}(egret.DisplayObjectContainer);__reflect(MainView.prototype,"MainView");var AllMissionsView=function(e){function t(t,i){var s=e.call(this)||this;return s.nowMissionIndex=0,s.missionData=t,s.missionCount=t.length,s.mainView=i,s}return __extends(t,e),t.prototype.toMission=function(e){this.deleteNowMission(),this.nowMissionIndex=e,this.nowMission=new Mission(this.missionData[e]),this.nowMissionView=new MissionView(e,this.nowMission,this),this.addChild(this.nowMissionView)},t.prototype.nextMission=function(){var e=this.nowMissionIndex===this.missionCount-1?0:this.nowMissionIndex+1;this.toMission(e)},t.prototype.resetMission=function(){this.toMission(this.nowMissionIndex)},t.prototype.deleteNowMission=function(){this.nowMission&&(this.removeChild(this.nowMissionView),this.nowMissionView=null,this.nowMission=null)},t.prototype.backToLobby=function(){this.deleteNowMission(),this.mainView.removeChild(this),this.mainView.addChild(this.mainView.lobby)},t}(egret.DisplayObjectContainer);__reflect(AllMissionsView.prototype,"AllMissionsView");var CellView=function(e){function t(t,i,s,n,o){var a=e.call(this)||this;return a.decorates=[],a.x=i,a.y=t,a.mapView=n,a.width=60,a.height=60,a.reset(),a.img=new egret.Bitmap,a.img.texture=RES.getRes(s),a.touchEnabled=!0,o?a.animeShow(o):(a.img.x=(60-a.img.width)/2,a.img.y=(60-a.img.height)/2,a.addChild(a.img)),a}return __extends(t,e),t.prototype.toggleType=function(e){var t=this;switch(this.decorates.forEach(function(e){return t.removeChild(e)}),this.decorates=[],e){case"column":var i=new egret.Bitmap;i.texture=RES.getRes("cellmain_json.top"),i.x=15,i.y=-5,this.addChild(i);var s=new egret.Bitmap;s.texture=RES.getRes("cellmain_json.bottom"),s.x=15,s.y=35,this.addChild(s),this.decorates.push(i,s);break;case"row":var n=new egret.Bitmap;n.texture=RES.getRes("cellmain_json.left"),n.x=-5,n.y=15,this.addChild(n);var o=new egret.Bitmap;o.texture=RES.getRes("cellmain_json.right"),o.x=35,o.y=15,this.addChild(o),this.decorates.push(n,o);break;case"cross":var a=new egret.Bitmap;a.texture=RES.getRes("cellmain_json.cross"),a.x=15,a.y=15,this.addChild(a),this.decorates.push(a)}},t.prototype.reset=function(){this.name=this.y+"_"+this.x,this.centreX=this.mapView.x+this.x+30,this.centreY=this.mapView.y+this.y+30},t.prototype.selected=function(){this.sel||(this.sel=new egret.Bitmap,this.sel.texture=RES.getRes("cellmain_json.selected"),this.sel.scale9Grid=new egret.Rectangle(5,5,this.sel.width-10,this.sel.height-10),this.sel.width=60,this.sel.height=60),this.addChild(this.sel)},t.prototype.unSelected=function(){this.sel&&this.sel.parent===this&&this.removeChild(this.sel)},t.prototype.getDirectionBy=function(e){if(e.x===this.x){if(e.y-this.y===60)return"bottom";if(e.y-this.y===-60)return"top"}if(e.y===this.y){if(e.x-this.x===60)return"right";if(e.x-this.x===-60)return"left"}return""},t.prototype.boom=function(){var e=this,t=egret.Tween.get(this.img);t.to({width:0,height:0,x:30,y:30},100,egret.Ease.backIn).call(function(){e.parent&&e.parent.removeChild(e)})},t.prototype.animeShow=function(e){var t=this,i=this.img.width,s=this.img.height,n=(60-i)/2,o=(60-i)/2;this.img.width=0,this.img.height=0,this.img.x=30,this.img.y=30,this.addChild(this.img);var a=egret.Tween.get(this.img);a.to({width:i,height:s,x:n,y:o},100,egret.Ease.backOut).call(function(){return t.toggleType(e)})},t}(egret.DisplayObjectContainer);__reflect(CellView.prototype,"CellView");var p,MapView=function(e){function t(t,i){var s=e.call(this)||this;return s._cellWidth=60,s._cellHeight=60,s.isMoveing=!1,s.touchCellView=null,s.testing=!1,s.mission=t,s.missionView=i,s.name="MapView",s._initMap(),s._initCells(),s.touchEnabled=!0,s.addEventListener(egret.TouchEvent.TOUCH_BEGIN,s.onTouchbegin,s),s}return __extends(t,e),t.prototype.test=function(){var e=this,t=this.mission.map.dataArr,i=t.length,s=["right","left","bottom","top"],n=function(){var n=t[~~(Math.random()*i)],o=s[~~(4*Math.random())],a=e.getCellViewByYX(n.y,n.x);e.touchCellView=a,e.tryMove(o,"default")};n()},t.prototype._initMap=function(){this.width=this._cellWidth*this.mission.widthCount,this.height=this._cellHeight*this.mission.heightCount,this.y=300,this.x=(ConstantData.CONTENT_WIDTH-this.width)/2,this.maskRect=new egret.Rectangle(0,0,this.width,this.height),this.mask=this.maskRect},t.prototype._initCells=function(){for(var e in this.mission.map.data){var t=this.mission.map.data[e];this._addCellView(t.y,t.x,t.name)}},t.prototype._addCellView=function(e,t,i,s){if(1===i.length){var n=new CellView(e*this._cellWidth,t*this._cellHeight,"cellmain_json."+i,this,s);this.addChild(n)}},t.prototype.onTouchbegin=function(e){if(!this.isMoveing)if("default"===this.missionView.touchType||"forceExchange"===this.missionView.touchType||"magic"===this.missionView.touchType)if(this.onTouchend(),this.touchCellView){if(this.touchCellView!==e.target){var t=this.touchCellView.getDirectionBy(e.target);t?this.tryMove(t,this.missionView.touchType):(this.touchCellView.unSelected(),this.touchCellView=e.target,this.touchCellView.selected())}}else this.touchCellView=e.target,this.touchCellView.selected(),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchmove,this);else if("hammer"===this.missionView.touchType){var i=Math.round(e.target.y/60),s=Math.round(e.target.x/60),n=this.mission.map.getCellByYX(i,s),o=this.mission.map.hammerActions(n);this.doActions(o),this.missionView.removeMask()}},t.prototype.onTouchmove=function(e){this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchend,this),this.touchCellView&&(e.stageX>this.touchCellView.centreX+50&&e.stageY<this.touchCellView.centreY+30&&e.stageY>this.touchCellView.centreY-30?(this.onTouchend(),this.tryMove("right",this.missionView.touchType)):e.stageX<this.touchCellView.centreX-50&&e.stageY<this.touchCellView.centreY+30&&e.stageY>this.touchCellView.centreY-30?(this.onTouchend(),this.tryMove("left",this.missionView.touchType)):e.stageY>this.touchCellView.centreY+50&&e.stageX<this.touchCellView.centreX+30&&e.stageX>this.touchCellView.centreX-30?(this.onTouchend(),this.tryMove("bottom",this.missionView.touchType)):e.stageY<this.touchCellView.centreY-50&&e.stageX<this.touchCellView.centreX+30&&e.stageX>this.touchCellView.centreX-30&&(this.onTouchend(),this.tryMove("top",this.missionView.touchType)))},t.prototype.onTouchend=function(){this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchmove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchend,this)},t.prototype.tryMove=function(e,t){this.touchCellView.unSelected();var i=Math.round(this.touchCellView.y/60),s=Math.round(this.touchCellView.x/60),n=this.mission.map.getCellByYX(i,s);if("forceExchange"===t||"default"===t){var o="forceExchange"===t;this.isMoveing=!0;var a=n.tryMoveGetAcitons(e,o);this.doActions(a),o&&this.missionView.removeMask()}else if("magic"===t){var r=n.tryMagic(e);this.doActions([r])}},t.prototype.getCellViewByYX=function(e,t){return this.getChildByName(60*e+"_"+60*t)},t.prototype.getColumnCellsViewByX=function(e){for(var t=[],i=0;i<this.numChildren;i++){var s=this.numChildren[i];s&&Math.round(s.x/60)===e&&t.push(s)}return t},t.prototype.getRowCellsByY=function(e){for(var t=[],i=0;i<this.numChildren;i++){var s=this.numChildren[i];Math.round(s.y/60)===e&&t.push(s)}return t},t.prototype.doActions=function(e){var t=this;console.log("actions",(new Date).toLocaleTimeString(),e);var i=function(e){return new Promise(function(i){switch(e.action){case"exchange":t.exchangeCell(i,e.cell1.y,e.cell1.x,e.cell2.y,e.cell2.x);break;case"boom":t.boomCells(i,e.data,e.specialBoom),e.requirement&&t.missionView.changeRequirement(e.requirement);break;case"createCells":t.createNewCells(i,e.newCells,e.downCells);break;case"specialCells":t.createSpecialCell(i,e.specialCells);break;case"magic":t.magicCell(i,e.magic);break;case"wait":t.wait(i,e.second)}})},s=e.slice(0),n=function(){var e=s.shift();e?i(e).then(function(){return n()}):t.actionEnd()};n()},t.prototype.actionEnd=function(){this.missionView.changeLimit(),this.touchCellView=null,"playing"!==this.mission.stage?this.missionView.balance():this.isMoveing=!1,this.testing&&this.test()},t.prototype.exchangeCell=function(e,t,i,s,n){var o=this.getCellViewByYX(t,i),a=this.getCellViewByYX(s,n);if(o&&a){var r=egret.Tween.get(o);r.to({x:a.x,y:a.y},200,egret.Ease.quadOut).call(function(){o.reset(),setTimeout(function(){e()},50)});var h=egret.Tween.get(a);h.to({x:o.x,y:o.y},200,egret.Ease.quadOut).call(function(){a.reset()})}},t.prototype.boomCells=function(e,t,i){var s=this;void 0===i&&(i=[]);var n=[];i.forEach(function(e){switch(e.type){case"column":var t=new egret.Bitmap;t.texture=RES.getRes("cellmain_json.square_round"),t.x=60*e.x+6,t.y=60*e.y+6,t.scale9Grid=new egret.Rectangle(5,5,t.width-10,t.height-10),t.alpha=.5,s.addChild(t);var i=egret.Tween.get(t);i.to({y:6,height:s.height-12},350,egret.Ease.backOut).call(function(){return s.removeChild(t)});break;case"row":var t=new egret.Bitmap;t.texture=RES.getRes("cellmain_json.square_round"),t.x=60*e.x+6,t.y=60*e.y+6,t.scale9Grid=new egret.Rectangle(5,5,t.width-10,t.height-10),t.alpha=.5,s.addChild(t);var i=egret.Tween.get(t);i.to({x:6,width:s.width-12},350,egret.Ease.backOut).call(function(){return s.removeChild(t)});break;case"cross":var o=new egret.Shape;o.graphics.lineStyle(1,.3),o.graphics.moveTo(60*e.x,60*(e.y-2)),o.graphics.lineTo(60*(e.x+1),60*(e.y-2)),o.graphics.lineTo(60*(e.x+1),60*(e.y-1)),o.graphics.lineTo(60*(e.x+2),60*(e.y-1)),o.graphics.lineTo(60*(e.x+2),60*e.y),o.graphics.lineTo(60*(e.x+3),60*e.y),o.graphics.lineTo(60*(e.x+3),60*(e.y+1)),o.graphics.lineTo(60*(e.x+2),60*(e.y+1)),o.graphics.lineTo(60*(e.x+2),60*(e.y+2)),o.graphics.lineTo(60*(e.x+1),60*(e.y+2)),o.graphics.lineTo(60*(e.x+1),60*(e.y+3)),o.graphics.lineTo(60*e.x,60*(e.y+3)),o.graphics.lineTo(60*e.x,60*(e.y+2)),o.graphics.lineTo(60*(e.x-1),60*(e.y+2)),o.graphics.lineTo(60*(e.x-1),60*(e.y+1)),o.graphics.lineTo(60*(e.x-2),60*(e.y+1)),o.graphics.lineTo(60*(e.x-2),60*e.y),o.graphics.lineTo(60*(e.x-1),60*e.y),o.graphics.lineTo(60*(e.x-1),60*(e.y-1)),o.graphics.lineTo(60*e.x,60*(e.y-1)),o.graphics.lineTo(60*e.x,60*(e.y-2)),o.graphics.endFill(),s.addChildAt(o,0),n.push(o)}});i.length>0?300:200;setTimeout(function(){n.forEach(function(e){e&&e.parent===s&&s.removeChild(e)});var i=function(e){t[e].forEach(function(t){var i=s.getCellViewByYX(t,+e.slice(1));i&&i.boom()})};for(var o in t)i(o);setTimeout(function(){return e()},150)},300)},t.prototype.createNewCells=function(e,t,i){var s=this,n=0;i.forEach(function(e){e.count>n&&(n=e.count)});var o=i.length;setTimeout(function(){t.forEach(function(e){s._addCellView(e.y,e.x,e.name)}),i.forEach(function(t){var i=s.getCellViewByYX(t.y,t.x);if(i){var n=egret.Tween.get(i);n.to({y:i.y+60*t.count},100*t.count,egret.Ease.quadOut).call(function(){i.reset(),o--,0===o&&setTimeout(function(){return e()},100)})}})},100)},t.prototype.createSpecialCell=function(e,t){var i=this;setTimeout(function(){t.forEach(function(e){var t=e.type,s=e.name,n=e.y,o=e.x;
i._addCellView(n,o,s,t)}),setTimeout(function(){e()},150)},100)},t.prototype.magicCell=function(e,t){var i=this.getCellViewByYX(t.y,t.x);i.toggleType(t.type),this.missionView.removeMask(),e()},t.prototype.wait=function(e,t){setTimeout(function(){e()},t)},t}(egret.DisplayObjectContainer);__reflect(MapView.prototype,"MapView");var MissionView=function(e){function t(t,i,s){var n=e.call(this)||this;return n._cellWidth=60,n._cellHeight=60,n._eachCountTFObj={},n.touchType="default",n.allMissionsView=s,n.name="MissionView",n.width=ConstantData.CONTENT_WIDTH,n.height=ConstantData.CONTENT_HEIGHT,n.mission=i,n.index=t,n.init(),n.initRequirement(),n.initLimit(),n.toolsView=new toolsView(n),n.toolsView.y=900,n.addChild(n.toolsView),n}return __extends(t,e),t.prototype.init=function(){var e=this,t=new egret.TextField;this.title=t,t.text="第"+(this.index+1)+"关",t.y=100,t.width=ConstantData.CONTENT_WIDTH,t.textAlign=egret.HorizontalAlign.CENTER,t.textColor=0,this.addChild(t);var i=new eui.Button;i.label="重置",i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){e.allMissionsView.resetMission()},this),this.addChild(i);var s=new eui.Button;s.label="下一关",s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){e.allMissionsView.nextMission()},this),this.addChild(s),s.x=120;var n=new eui.Button;n.label="返回",n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){e.allMissionsView.backToLobby()},this),this.addChild(n),n.x=240,this.mapView=new MapView(this.mission,this),this.addChild(this.mapView)},t.prototype.win=function(){this.title.text+=" 你赢了"},t.prototype.dead=function(){this.title.text+=" 步数用完，你输了"},t.prototype.initRequirement=function(){var e=this;switch(this.mission.requireType){case"eachCount":var t=this.mission.requireMentEachCount;Object.keys(t).forEach(function(i,s){var n=new egret.Bitmap;n.texture=RES.getRes("cellmain_json."+i),n.y=200,n.x=100*s+100,e.addChild(n);var o=new egret.TextField;o.text=t[i],o.y=210,o.textColor=0,o.x=100*s+155,e.addChild(o),e._eachCountTFObj[i]=o})}},t.prototype.initLimit=function(){switch(this.mission.limitType){case"count":var e=this.mission.limitCount,t=new egret.TextField;this._limitCountTF=t,t.text="步数",t.y=210,t.textColor=0,t.x=500,this.addChild(t);var i=new egret.TextField;this._limitCountTF=i,i.text=e.toString(),i.y=210,i.textColor=0,i.x=580,this.addChild(i)}},t.prototype.changeRequirement=function(e){switch(this.mission.requireType){case"eachCount":for(var t in e)this._eachCountTFObj[t].text=e[t].toString()}},t.prototype.changeLimit=function(){switch(this.mission.limitType){case"count":this._limitCountTF.text=this.mission.limitCount.toString()}},t.prototype.balance=function(){switch(this.mission.stage){case"dead":this.dead();break;case"win":this.win()}},t.prototype.changeTouchType=function(){var e=this;this._mask=new egret.Shape,this._mask.graphics.beginFill(0,.5),this._mask.graphics.drawRect(0,0,this.width,this.height),this._mask.touchEnabled=!0,this.addChild(this._mask),this._mask.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){return e.removeMask()},this),this.setChildIndex(this.mapView,this.numChildren)},t.prototype.removeMask=function(){this.removeChild(this._mask),this.touchType="default",this.mask=null},t}(egret.DisplayObjectContainer);__reflect(MissionView.prototype,"MissionView");var toolsView=function(e){function t(t){var i=e.call(this)||this;return i.missionView=t,i.width=ConstantData.CONTENT_WIDTH,i.init(),i}return __extends(t,e),t.prototype.init=function(){var e=this,t=new egret.Bitmap;t.texture=RES.getRes("cellmain_json._5"),t.x=100,this.addChild(t),t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){return e.increaseLimitCount()},this);var i=new egret.Bitmap;i.texture=RES.getRes("cellmain_json.hammer"),i.x=200,this.addChild(i),i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){return e.hammerCell()},this);var s=new egret.Bitmap;s.texture=RES.getRes("cellmain_json.exchange"),s.x=300,this.addChild(s),s.touchEnabled=!0,s.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){return e.forceExchangeCell()},this);var n=new egret.Bitmap;n.texture=RES.getRes("cellmain_json.magic"),n.x=400,this.addChild(n),n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){return e.magicCell()},this)},t.prototype.increaseLimitCount=function(){"playing"===this.missionView.mission.stage&&(this.missionView.mission.toolIncreaseLimitCount(),this.missionView.changeLimit())},t.prototype.hammerCell=function(){"playing"===this.missionView.mission.stage&&(this.missionView.touchType="hammer",this.missionView.changeTouchType())},t.prototype.forceExchangeCell=function(){"playing"===this.missionView.mission.stage&&(this.missionView.touchType="forceExchange",this.missionView.mapView.touchCellView&&(this.missionView.mapView.touchCellView.unSelected(),this.missionView.mapView.touchCellView=null),this.missionView.changeTouchType())},t.prototype.magicCell=function(){"playing"===this.missionView.mission.stage&&(this.missionView.touchType="magic",this.missionView.mapView.touchCellView&&(this.missionView.mapView.touchCellView.unSelected(),this.missionView.mapView.touchCellView=null),this.missionView.changeTouchType())},t}(egret.DisplayObjectContainer);__reflect(toolsView.prototype,"toolsView");var WinPopup=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(egret.DisplayObjectContainer);__reflect(WinPopup.prototype,"WinPopup");