var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},LobbyBtn=function(t){function e(e,i,n,s,o){var r=t.call(this)||this;r.x=e,r.y=i;var a=new egret.Bitmap;a.texture=RES.getRes("main_lobby_json.btn_0"),a.scale9Grid=new egret.Rectangle(20,20,a.width-40,a.height-40),a.width=400,a.height=100,a.touchEnabled=!0,r.addChild(a);var h=new egret.TextField;return h.text=n,r.addChild(h),h.textColor=16777215,h.size=48,h.width=400,h.textAlign=egret.HorizontalAlign.CENTER,h.height=100,h.verticalAlign=egret.VerticalAlign.MIDDLE,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return s.call(o)},r),r}return __extends(e,t),e}(egret.DisplayObjectContainer);__reflect(LobbyBtn.prototype,"LobbyBtn");var ConstantData=function(){function t(){}return t.getStageWidth=function(){return egret.MainContext.instance.stage.stageWidth},t.getStageHeight=function(){return egret.MainContext.instance.stage.stageHeight},t}();ConstantData.TextColors={roomBlue:7194537,white:16777215,milkWhite:16511407,grayWhite:13547170,yellow:16776960,lightYellow:16765813,orangeYellow:16750848,orange:16764489,red:15799040,green:58624,lgreen:6474584,blue:1742039,grayBlue:3101047,purple:15284466,pink:16724016,black:3026221,golden:16766720},ConstantData.LabelFontSize={miniSize:12,smallSize:14,middleSize:18,normalSize:24,bigSize:36},ConstantData.frame=60,ConstantData.CONTENT_WIDTH=750,ConstantData.CONTENT_HEIGHT=1206,__reflect(ConstantData.prototype,"ConstantData");var Utils=function(){function t(){}return t.randomInt=function(t,e){var i=e-t+1;return Math.floor(Math.random()*i+t)},t.shuffle=function(t,e){void 0===e&&(e=t.length);for(var i=t.slice(0),n=i.length,s=[],o=n;o>n-e;o--){var r=i.splice(~~(Math.random()*o),1)[0];s.push(r)}return s},t.getRandomItemByArray=function(t){var e=this.randomInt(0,t.length-1);return t[e]},t.getRandomIndexByWeights=function(t){for(var e=0,i=Math.random()*t.reduce(function(t,e){return t+e}),n=0;n<t.length;n++)if(e+=t[n],e>=i)return n},t}();__reflect(Utils.prototype,"Utils");var JiebaRule=function(){function t(){}return t.computeBossWeight=function(t){var e=this.x,i=this.y,n=e+i*(Math.log(t)/Math.log(10)-1);this.weights[12]=Math.floor(1e4*(n+Math.pow(n,2)))},t.getCoinRate=function(){return Utils.randomInt(18,30)/12},t.dealBets=function(t){var e=t.reduce(function(t,e){return t+e});this.computeBossWeight(e);var i,n=Utils.getRandomIndexByWeights(this.weights);return i=13===n?Math.round(this.getCoinRate()*e):12===n?0:this.rates[n]*t[n],Lobby.ins.user.changeGold(e,i),{index:n,result:i,numBets:e}},t}();JiebaRule.x=.05,JiebaRule.y=.02,JiebaRule.weights=[3408,1363,852,682,568,454,341,273,170,136,91,68,0,1594],JiebaRule.rates=[2,5,8,10,12,15,25,40,50,75,100,0],__reflect(JiebaRule.prototype,"JiebaRule");var JiebaCard=function(t){function e(e,i,n){void 0===i&&(i=20);var s=t.call(this)||this;return s.bet=0,s.isActive=!1,s.rate=i,s.id=e,s.cardBoxBottom=n,s.person=new egret.Bitmap,s.person.texture=RES.getRes("card_jieba_json."+e+"a"),s.person.anchorOffsetX=s.person.width/2,s.person.anchorOffsetY=s.person.height/2,s.person.y=10+s.person.anchorOffsetY,s.person.x=s.person.anchorOffsetX,s.addChild(s.person),s.person.touchEnabled=!0,s.person.addEventListener(egret.TouchEvent.TOUCH_TAP,s.tapHandler,s),s.rateBm=new egret.Bitmap,s.addChild(s.rateBm),s.rateTF=new egret.TextField,s.rateTF.text=s.rate+" 倍",s.rateTF.width=100,s.rateTF.size=19,s.rateTF.textColor=0,s.rateTF.y=4,s.rateTF.textAlign=egret.HorizontalAlign.CENTER,s.addChild(s.rateTF),s.betBm=new egret.Bitmap,s.betBm.y=158,s.addChild(s.betBm),s.betTF=new egret.TextField,s.betTF.text=s.bet.toString(),s.betTF.width=100,s.betTF.size=19,s.betTF.textColor=0,s.betTF.y=162,s.betTF.textAlign=egret.HorizontalAlign.CENTER,s.addChild(s.betTF),s.unactive(),s}return __extends(e,t),e.prototype.tapHandler=function(){var t=this.cardBoxBottom.mainView;t.isplaying||(Lobby.ins.user.gold-t.numBets>=t.unit?(this.plusBet(t.unit),this.active(),t.bet()):Lobby.ins.user.goldNotEnough())},e.prototype.plusBet=function(t){this.bet+=t,this.betTF.text=this.bet.toString()},e.prototype.active=function(){this.person.texture=RES.getRes("card_jieba_json."+this.id+"a"),this.rateBm.texture=RES.getRes("main_jieba_json.rate1"),this.betBm.texture=RES.getRes("main_jieba_json.bet1")},e.prototype.unactive=function(){this.person.texture=RES.getRes("card_jieba_json."+this.id+"b"),this.rateBm.texture=RES.getRes("main_jieba_json.rate2"),this.betBm.texture=RES.getRes("main_jieba_json.bet2")},e.prototype.clear=function(){this.bet=0,this.betTF.text=this.bet.toString()},e.prototype.animate=function(t,e){var i=this;void 0===e&&(e=1e3);var n=this.person.texture,s=egret.Tween.get(this.person);s.to({scaleX:0},e/4).call(function(){var e=t?"card_jieba_json.bg":"card_jieba_json.bg1";i.person.texture=RES.getRes(e)}).to({scaleX:1},e/4).to({scaleX:0},e/4).call(function(){i.person.texture=n}).to({scaleX:1},e/4)},e}(egret.DisplayObjectContainer);__reflect(JiebaCard.prototype,"JiebaCard");var JiebaCardBoxBottom=function(t){function e(e){var i=t.call(this)||this;return i.cards=[],i.init(),i.mainView=e,i}return __extends(e,t),e.prototype.init=function(){for(var t=[2,5,8,10,12,15,20,25,40,50,75,100],e=0;12>e;e++){var i=new JiebaCard(e,t[e],this);i.y=195*~~(e/6)+20,i.x=e%6*120+25,this.addChild(i),this.cards.push(i)}},e.prototype.clear=function(){this.cards.forEach(function(t){t.clear(),t.unactive()})},e.prototype.getCardBets=function(){return this.cards.map(function(t){return t.bet})},e}(egret.DisplayObjectContainer);__reflect(JiebaCardBoxBottom.prototype,"JiebaCardBoxBottom");var JiebaCardBoxTop=function(t){function e(){var e=t.call(this)||this;return e.cardBgs=[],e.init(),e}return __extends(e,t),e.prototype.init=function(){for(var t=0;14>t;t++){var e=new egret.Bitmap;e.texture=RES.getRes("main_jieba_json.cardBg"),e.y=190*~~(t/7)+5,e.x=t%7*100+10+65,e.anchorOffsetX=65,this.addChild(e);var i=7>t?t:20-t;this.cardBgs[i]=e}this.resultCard=new egret.Bitmap,this.resultCard.visible=!1,this.resultCard.anchorOffsetX=65,this.addChild(this.resultCard)},e.prototype.active=function(t){this.cardBgs[t].texture=RES.getRes("main_jieba_json.cardBg1")},e.prototype.unactive=function(t){this.cardBgs[t].texture=RES.getRes("main_jieba_json.cardBg")},e.prototype.run=function(t){var e=this,i=Utils.randomInt(0,13),n=42+i,s=0,o=function(){var r=n/2>s?s:n-s,a=~~(500*(Math.sqrt(r+2)-Math.sqrt(r+1)));setTimeout(function(){e.unactive(s%14),e.active(++s%14),n>s?o():e.move(t,i)},a)};o()},e.prototype.move=function(t,e){var i=this;this.resultCard.texture=RES.getRes("main_jieba_json.cardBg1"),this.resultCard.y=this.cardBgs[e].y,this.resultCard.x=this.cardBgs[e].x,this.resultCard.scaleX=1,this.resultCard.scaleY=1,this.resultCard.visible=!0,this.resultCard.alpha=1,this.cardBgs[e].visible=!1;var n=egret.Tween.get(this.resultCard);n.wait(400).to({y:488,x:370,scaleX:1.35,scaleY:1.35},300).wait(400).to({scaleX:0},200).call(function(){i.resultCard.texture=RES.getRes("result_jieba_json."+t),Sound.ins.allow&&Sound.ins.card.play(0,1)}).to({scaleX:1.35},200).wait(200).call(function(){i.changeGold()}).wait(2e3).to({alpha:0},400).call(function(){i.cardBgs[e].texture=RES.getRes("main_jieba_json.cardBg"),i.cardBgs[e].visible=!0,i.resultCard.visible=!1,i.endGame()})},e}(egret.DisplayObjectContainer);__reflect(JiebaCardBoxTop.prototype,"JiebaCardBoxTop");var GoldSelect=function(t){function e(e){var i=t.call(this)||this;return i.isSelect=!1,i.menuTFs=[],i.mainView=e,i.init(),i}return __extends(e,t),e.prototype.init=function(){var t=this;this.menu=new egret.Bitmap,this.menu.texture=RES.getRes("main_jieba_json.menu"),this.menu.y=530,this.menu.x=25,this.addChild(this.menu),this.menu.visible=!1;for(var e=function(e){var n=new egret.TextField,s=Math.pow(10,e+1);n.text=s.toString(),n.size=24,n.y=750-42*e-42,n.height=42,n.x=70,n.width=100,n.textAlign=egret.HorizontalAlign.CENTER,i.addChild(n),n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return t.menuSelect(s)},i),n.visible=!1,i.menuTFs.push(n)},i=this,n=0;5>n;n++)e(n);this.select=new egret.Bitmap,this.select.texture=RES.getRes("main_jieba_json.select"),this.select.y=740,this.select.x=25,this.addChild(this.select),this.select.touchEnabled=!0,this.select.addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectHandler,this),this.selectTF=new egret.TextField,this.selectTF.text=this.mainView.unit.toString(),this.selectTF.size=24,this.selectTF.y=750,this.selectTF.x=70,this.selectTF.width=100,this.selectTF.textAlign=egret.HorizontalAlign.CENTER,this.addChild(this.selectTF)},e.prototype.selectHandler=function(){this.mainView.isplaying||(Sound.ins.allow&&Sound.ins.ai.play(0,1),this.isSelect?(this.menu.visible=!1,this.isSelect=!1,this.menuTFs.forEach(function(t){return t.visible=!1})):(this.menu.visible=!0,this.isSelect=!0,this.menuTFs.forEach(function(t){return t.visible=!0})))},e.prototype.menuSelect=function(t){Lobby.ins.user.gold-this.mainView.numBets>=t?(this.mainView.unit=t,this.selectTF.text=t.toString()):Lobby.ins.user.goldNotEnough(),Sound.ins.allow&&Sound.ins.ai.play(0,1),this.menu.visible=!1,this.isSelect=!1,this.menuTFs.forEach(function(t){return t.visible=!1})},e}(egret.DisplayObjectContainer);__reflect(GoldSelect.prototype,"GoldSelect");var JiebaMainView=function(t){function e(){var e=t.call(this)||this;return e.isplaying=!1,e.unit=10,e.numBets=0,e.width=ConstantData.CONTENT_WIDTH,e.height=ConstantData.CONTENT_HEIGHT,e.init(),e.titleHandler(),e}return __extends(e,t),e.prototype.init=function(){var t=new egret.Bitmap;t.texture=RES.getRes("bg_jieba_json.bg"),t.touchEnabled=!0,this.addChild(t),this.clearBtn=new egret.Bitmap,this.clearBtn.texture=RES.getRes("main_jieba_json.clear"),this.clearBtn.y=755,this.clearBtn.x=550,this.addChild(this.clearBtn),this.clearBtn.touchEnabled=!0,this.clearBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clearHandler,this),this.goBtn=new egret.Bitmap,this.goBtn.texture=RES.getRes("main_jieba_json.go2"),this.goBtn.y=747,this.goBtn.x=260,this.addChild(this.goBtn),this.goBtn.touchEnabled=!0,this.goBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.goHandler,this),this.goldSelect=new GoldSelect(this),this.goldSelect.y=15,this.addChild(this.goldSelect),this.backBtn=new egret.Bitmap,this.backBtn.texture=RES.getRes("main_jieba_json.back"),this.backBtn.y=400,this.backBtn.x=605,this.addChild(this.backBtn),this.backBtn.touchEnabled=!0,this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backHandler,this),this.title=new egret.Bitmap,this.title.texture=RES.getRes("main_jieba_json.title"),this.title.y=400,this.title.x=255,this.addChild(this.title),this.title.touchEnabled=!0,this.title.addEventListener(egret.TouchEvent.TOUCH_TAP,this.titleHandler,this),this.musicBtn=new egret.Bitmap,this.musicBtn.texture=Sound.ins.allow?RES.getRes("main_jieba_json.music"):RES.getRes("main_jieba_json.music1"),this.musicBtn.y=400,this.musicBtn.x=25,this.addChild(this.musicBtn),this.musicBtn.touchEnabled=!0,this.musicBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.musicHandler,this);var e=new egret.Bitmap;e.texture=RES.getRes("main_jieba_json.gold"),e.y=490,e.x=30,this.addChild(e),this.goldTF=new egret.TextField,this.goldTF.text=Lobby.ins.user.gold.toString(),this.goldTF.size=36,this.goldTF.y=497,this.goldTF.x=88,this.addChild(this.goldTF),this.plusGoldTF=new egret.TextField,this.plusGoldTF.y=500,this.plusGoldTF.alpha=0,this.addChild(this.plusGoldTF),this.cardBoxBottom=new JiebaCardBoxBottom(this),this.cardBoxBottom.y=796,this.addChild(this.cardBoxBottom),this.cardBoxTop=new JiebaCardBoxTop,this.addChild(this.cardBoxTop),this.endTF=new egret.TextField,this.endTF.size=120,this.endTF.y=555,this.endTF.width=ConstantData.CONTENT_WIDTH,this.endTF.textAlign=egret.HorizontalAlign.CENTER,this.endTF.alpha=0,this.addChild(this.endTF)},e.prototype.musicHandler=function(){Sound.ins.allow?(this.musicBtn.texture=RES.getRes("main_jieba_json.music1"),Sound.ins.allow=!1):(this.musicBtn.texture=RES.getRes("main_jieba_json.music"),Sound.ins.allow=!0,Sound.ins.ai.play(0,1))},e.prototype.goHandler=function(){var t=this;if(!this.isplaying&&this.numBets>0){this.goBtn.texture=RES.getRes("main_jieba_json.go2"),this.isplaying=!0,this.goldSelect.menuSelect(this.unit),Sound.ins.allow&&Sound.ins.ai.play(0,1);var e=this.cardBoxBottom.getCardBets();this.numBets=0,this.unactiveGoBtn();var i=JiebaRule.dealBets(e),n=i.index,s=i.result;i.numBets;console.log(e,n,s),this.cardBoxTop.changeGold=function(){if(s>0&&t.plusGold(s),13===n)t.endTFShow("YOU WIN");else if(12===n)t.endTFShow("YOU LOSE");else{var e=t.cardBoxBottom.cards[n];e.bet>0?(e.animate(!0),t.endTFShow("YOU WIN")):(e.animate(!1),t.endTFShow("YOU LOSE"))}},this.cardBoxTop.endGame=function(){t.cardBoxBottom.clear(),t.isplaying=!1,t.endTFHide()},this.cardBoxTop.run(n)}},e.prototype.plusGold=function(t){var e=this;this.plusGoldTF.text="+"+t,this.plusGoldTF.x=93,this.plusGoldTF.y=535;var i=egret.Tween.get(this.plusGoldTF);i.to({alpha:1},500).call(function(){e.goldTF.text=Lobby.ins.user.gold.toString()}).wait(1e3).to({alpha:0},300)},e.prototype.endTFShow=function(t){this.endTF.text=t;var e=egret.Tween.get(this.endTF);e.to({alpha:1},500)},e.prototype.endTFHide=function(){var t=egret.Tween.get(this.endTF);t.to({alpha:0},300)},e.prototype.activeGoBtn=function(){this.goBtn.texture=RES.getRes("main_jieba_json.go1")},e.prototype.unactiveGoBtn=function(){this.goBtn.texture=RES.getRes("main_jieba_json.go2")},e.prototype.clearHandler=function(){this.isplaying||(this.cardBoxBottom.clear(),this.numBets=0,this.goldTF.text=Lobby.ins.user.gold.toString(),this.unactiveGoBtn(),Sound.ins.allow&&Sound.ins.ai.play(0,1))},e.prototype.titleHandler=function(){var t=this;if(!this.isplaying){Sound.ins.allow&&Sound.ins.ai.play(0,1);var e=new egret.Shape;e.graphics.beginFill(0,.7),e.graphics.drawRect(0,0,this.width,this.height),e.graphics.endFill(),this.addChild(e),e.touchEnabled=!0;var i=new egret.Bitmap;i.texture=RES.getRes("bg_jieba_json.rule"),this.addChild(i),i.x=(this.width-i.width)/2,i.y=(this.height-i.height)/2;var n=function(){t.removeChild(e),t.removeChild(i)};e.addEventListener(egret.TouchEvent.TOUCH_TAP,n,this),i.addEventListener(egret.TouchEvent.TOUCH_TAP,n,this)}},e.prototype.bet=function(){this.numBets+=this.unit,this.goldTF.text=(Lobby.ins.user.gold-this.numBets).toString(),this.activeGoBtn(),Sound.ins.allow&&Sound.ins.bet.play(0,1)},e.prototype.backHandler=function(){Sound.ins.allow&&Sound.ins.ai.play(0,1),Lobby.ins.back(this)},e}(egret.DisplayObjectContainer);__reflect(JiebaMainView.prototype,"JiebaMainView");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Lobby=function(t){function e(){var e=t.call(this)||this;return e.user=new User(5e3),e.init(),e}return __extends(e,t),Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.init=function(){var t=this,e=new egret.Bitmap;e.texture=RES.getRes("main_lobby_json.bg"),this.addChild(e),this.goldTF=new egret.TextField,this.goldTF.width=750,this.goldTF.textAlign=egret.HorizontalAlign.CENTER,this.goldTF.y=700,this.goldTF.size=48,this.goldTF.text=this.user.gold.toString(),this.addChild(this.goldTF);var i=new LobbyBtn(175,200,"街霸水果机",function(){t.jieba=new JiebaMainView,t.addChild(t.jieba)},this);this.addChild(i);var n=new LobbyBtn(175,350,"趣味老虎机",function(){t.slot=new SoltMainView,t.addChild(t.slot)},this);this.addChild(n);var s=new LobbyBtn(175,500,"打地鼠",function(){t.suslik=new SuslikMap,t.addChild(t.suslik)},this);this.addChild(s)},e.prototype.back=function(t){t.parent===this&&(this.removeChild(t),t=null,this.goldTF.text=this.user.gold.toString())},e}(egret.DisplayObjectContainer);__reflect(Lobby.prototype,"Lobby");var Sound=function(){function t(){this.allow=!0,this.ai=RES.getRes("ai_mp3"),this.bet=RES.getRes("bet_mp3"),this.card=RES.getRes("card_mp3"),this.ko=RES.getRes("ko_mp3"),this.pk=RES.getRes("pk_mp3")}return Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t),this._ins},enumerable:!0,configurable:!0}),t}();__reflect(Sound.prototype,"Sound");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){this.addChild(Lobby.ins)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.startAnimation=function(t){var e=this,i=new egret.HtmlTextParser,n=t.map(function(t){return i.parse(t)}),s=this.textfield,o=-1,r=function(){o++,o>=n.length&&(o=0);var t=n[o];s.textFlow=t;var i=egret.Tween.get(s);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(r,e)};r()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var SoltFruitGroup=function(t){function e(e){var i=t.call(this)||this;return i.fruitCount=9,i.fruitHeight=137,i.fruitsHeight=1233,i.index=-2,i.nowFruit=0,i.mainView=e,i.init(),i}return __extends(e,t),e.prototype.init=function(){do this.addFruits();while(this.index<1)},e.prototype.run=function(t,e){var i=this,n=!1,s=function(){return new Promise(function(s){t>0?(i.runOne(s),t--):n||(i.runToFruit(e,s),n=!0)})},o=function(){n?(SoltGame.reelEnd(),SoltGame.isPlaying||i.mainView.runEnd()):s().then(function(){return o()})};o()},e.prototype.runOne=function(t){this.addFruits();var e=egret.Tween.get(this);e.to({y:this.y+this.fruitsHeight},900).call(function(){return t()})},e.prototype.runToFruit=function(t,e){var i=this;this.addFruits(),this.addFruits();var n=2*this.fruitCount-this.nowFruit+t,s=egret.Tween.get(this),o=this.y+n*this.fruitHeight;s.to({y:o},300*n,egret.Ease.quartOut).call(function(){i.nowFruit=t,e()})},e.prototype.addFruits=function(){var t=new SoltFruits(++this.index);this.addChild(t);var e=this.getChildByName("Fruits "+(this.index-4));e&&e.parent==this&&(this.removeChild(e),e=null)},e}(egret.DisplayObjectContainer);__reflect(SoltFruitGroup.prototype,"SoltFruitGroup");var SoltFruits=function(t){function e(e){var i=t.call(this)||this;return i.fruitCount=9,i.fruitHeight=137,i.fruits=[0,8,7,6,5,4,3,2,1],i.name="Fruits "+e,i.height=i.fruitCount*i.fruitHeight,i.y=-1*e*i.height,i.init(),i}return __extends(e,t),e.prototype.init=function(){var t=this;this.fruits.forEach(function(e,i){var n=new egret.Bitmap;n.texture=RES.getRes("fruit_solt_json."+e),n.x=4,n.y=t.fruitHeight*i-3,t.addChild(n)})},e}(egret.DisplayObjectContainer);__reflect(SoltFruits.prototype,"SoltFruits");var SoltGame=function(){function t(){}return t.reelEnd=function(){this.reelEndCount++,3==this.reelEndCount&&(this.reelEndCount=0,this.isPlaying=!1)},t.clear=function(){this.isPlaying=!1,this.reelEndCount=0},t.soltMachine=function(t){this.computeNoEqualWeight(t);var e=Utils.getRandomIndexByWeights(this.weights),i=this.types[e],n=this.rates[e],s=Math.round(t*n);Lobby.ins.user.changeGold(t,s);var o=this.dealType(i);return console.log(i,o,t,n),[o,n]},t.computeNoEqualWeight=function(t){this.weights[0]=Math.round(1782+1e4*(this.x+this.y*(Math.log(t)/Math.log(10)-1)))},t.twoEqual=function(t){var e=this.fruits.slice(0),i=e.indexOf(t);e.splice(i,1);var n=Utils.getRandomItemByArray(e);return Utils.shuffle([t,t,n])},t.threeEqual=function(t){return[t,t,t]},t.noEqual=function(){return Utils.shuffle(this.fruits,3)},t.dealType=function(t){if(1===t.length)return this.noEqual();if(2===t.length){var e=+t[0]-1;return this.twoEqual(e)}if(3===t.length){var e=+t[0]-1;return this.threeEqual(e)}},t}();SoltGame.isPlaying=!1,SoltGame.reelEndCount=0,SoltGame.fruits=[0,1,2,3,4,5,6,7,8],SoltGame.x=.1,SoltGame.y=.02,SoltGame.weights=[0,294,102,59,45,37,28,15,7,3,2327,1763,1363,837,571,406,228,102,45],SoltGame.rates=[0,2,5,8,10,12,15,25,50,100,.2,.5,.8,1,1.2,1.5,2.5,5,10],SoltGame.types=["0","111","222","333","444","555","666","777","888","999","11","22","33","44","55","66","77","88","99"],__reflect(SoltGame.prototype,"SoltGame");var SoltMainView=function(t){function e(){var e=t.call(this)||this;return e.reels=[],e.lightTwinkleTimer=null,e.lamps=[],e.bet=10,e.unit=100,e.rate=0,e.betArr=[10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5],e.betIndex=0,e.width=ConstantData.CONTENT_WIDTH,e.height=ConstantData.CONTENT_HEIGHT,e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=new egret.Bitmap;t.texture=RES.getRes("main_slot_json.bg"),t.height=1206,t.touchEnabled=!0,this.addChild(t);var e=new egret.Shape;e.graphics.beginFill(16777215),e.graphics.drawRect(109,494,530,137),e.graphics.endFill(),this.addChild(e);var i=new egret.Bitmap;i.texture=RES.getRes("main_slot_json.machine"),this.addChild(i);var n=new egret.Bitmap;n.texture=RES.getRes("main_slot_json.head"),this.addChild(n);for(var s=0;3>s;s++){var o=new SoltReel(this);o.x=109+175*s,o.y=494,this.addChild(o),this.reels.push(o)}this.goBtn=new egret.Bitmap,this.goBtn.texture=RES.getRes("main_slot_json.goBtn0"),this.goBtn.y=841,this.goBtn.x=309,this.addChild(this.goBtn),this.goBtn.touchEnabled=!0;for(var r=[94,167,234,480,547,609],s=0;6>s;s++){var a=new egret.Bitmap;a.texture=RES.getRes("main_slot_json.orangeLamp"),a.y=780,a.x=r[s],this.addChild(a),this.lamps.push(a)}this.ruleBtn=new egret.Bitmap,this.ruleBtn.texture=RES.getRes("main_slot_json.ruleBtn0"),this.ruleBtn.x=84,this.ruleBtn.y=845,this.addChild(this.ruleBtn),this.ruleBtn.touchEnabled=!0,this.soundBtn=new egret.Bitmap,this.soundBtn.texture=Sound.ins.allow?RES.getRes("main_slot_json.soundOn0"):RES.getRes("main_slot_json.soundOff0"),this.soundBtn.x=603,this.soundBtn.y=845,this.addChild(this.soundBtn),this.soundBtn.touchEnabled=!0,this.plusBetBtn=new egret.Bitmap,this.plusBetBtn.texture=RES.getRes("main_slot_json.plusBet0"),this.plusBetBtn.x=489,this.plusBetBtn.y=875,this.addChild(this.plusBetBtn),this.plusBetBtn.touchEnabled=!0,this.minusBetBtn=new egret.Bitmap,this.minusBetBtn.texture=RES.getRes("main_slot_json.minusBet0"),this.minusBetBtn.x=167,this.minusBetBtn.y=875,this.addChild(this.minusBetBtn),this.minusBetBtn.touchEnabled=!0,this.escBtn=new egret.Bitmap,this.escBtn.texture=RES.getRes("main_slot_json.escBtn"),this.escBtn.x=138,this.escBtn.y=1057,this.addChild(this.escBtn),this.escBtn.touchEnabled=!0,this.shareBtn=new egret.Bitmap,this.shareBtn.texture=RES.getRes("main_slot_json.shareBtn"),this.shareBtn.x=463,this.shareBtn.y=1057,this.addChild(this.shareBtn),this.shareBtn.touchEnabled=!0;var h=new egret.Bitmap;h.texture=RES.getRes("main_slot_json.handBase"),h.x=679,h.y=692,this.addChild(h),this.handPole=new egret.Bitmap,this.handPole.texture=RES.getRes("main_slot_json.handPole"),this.handPole.x=595,this.handPole.y=713,this.handPole.anchorOffsetY=130,this.handPole.anchorOffsetX=6,this.handPole.rotation=30,this.handBall=new egret.Bitmap,this.handBall.texture=RES.getRes("main_slot_json.handBall"),this.handBall.x=679,this.handBall.y=692,this.light=new egret.Bitmap,this.light.texture=RES.getRes("main_slot_json.light0"),this.light.x=88,this.light.y=435,this.addChild(this.light),this.goldTF=new egret.TextField,this.goldTF.x=85,this.goldTF.width=270,this.goldTF.textAlign=egret.HorizontalAlign.CENTER,this.goldTF.y=380,this.goldTF.text=Lobby.ins.user.gold.toString(),this.addChild(this.goldTF),this.changeGoldTF=new egret.TextField,this.changeGoldTF.x=370,this.changeGoldTF.y=380,this.changeGoldTF.text="",this.changeGoldTF.alpha=0,this.changeGoldTF.textColor=13278,this.addChild(this.changeGoldTF),this.betTF=new egret.TextField,this.betTF.x=271,this.betTF.width=200,this.betTF.y=725,this.betTF.textAlign=egret.HorizontalAlign.CENTER,this.betTF.text="10",this.addChild(this.betTF),this.bindEvent(),this.lightTwinkle(500),this.lampTwinkle(500)},e.prototype.bindEvent=function(){var t=this;this.escBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){Sound.ins.allow&&Sound.ins.ai.play(0,1),SoltGame.clear(),Lobby.ins.back(t)},this),this.goBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.goHandler,this),this.ruleBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){Sound.ins.allow&&Sound.ins.ai.play(0,1),t.ruleBtn.texture=RES.getRes("main_slot_json.ruleBtn1");var e=function(){t.ruleBtn.texture=RES.getRes("main_slot_json.ruleBtn0"),t.stage.removeEventListener(egret.TouchEvent.TOUCH_END,e,t)};t.stage.addEventListener(egret.TouchEvent.TOUCH_END,e,t)},this),this.soundBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.soundBtn.texture=Sound.ins.allow?RES.getRes("main_slot_json.soundOn1"):RES.getRes("main_slot_json.soundOff1");var e=function(){Sound.ins.allow=!Sound.ins.allow,t.soundBtn.texture=Sound.ins.allow?RES.getRes("main_slot_json.soundOn0"):RES.getRes("main_slot_json.soundOff0"),t.stage.removeEventListener(egret.TouchEvent.TOUCH_END,e,t)};t.stage.addEventListener(egret.TouchEvent.TOUCH_END,e,t)},this),this.plusBetBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.plusBetHandler,this),this.minusBetBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.minusBetHandler,this)},e.prototype.run=function(t){this.lightTwinkle(150),this.plusBetBtn.texture=RES.getRes("main_slot_json.plusBet2"),this.minusBetBtn.texture=RES.getRes("main_slot_json.minusBet2"),this.reels.forEach(function(e,i){e.run(i,t[i])})},e.prototype.runEnd=function(){for(this.lightTwinkle(500),this.rate>0&&this.changeGoldTFShow("+ "+this.bet+" × "+this.rate,!1);Lobby.ins.user.gold<this.bet&&Lobby.ins.user.gold>=this.betArr[0];)this.minusBet();Lobby.ins.user.gold<this.betArr[0]&&Lobby.ins.user.goldNotEnough(),this.goBtn.texture=RES.getRes("main_slot_json.goBtn0"),this.plusBetBtn.texture=RES.getRes("main_slot_json.plusBet0"),this.minusBetBtn.texture=RES.getRes("main_slot_json.minusBet0")},e.prototype.lightTwinkle=function(t){var e=this;void 0===t&&(t=1e3),null!==this.lightTwinkleTimer&&clearTimeout(this.lightTwinkleTimer);var i=1;this.lightTwinkleTimer=setInterval(function(){e.light.texture=RES.getRes("main_slot_json.light"+i),i=0==i?1:0},t)},e.prototype.lampTwinkle=function(t){var e=this;void 0===t&&(t=1e3);var i=0;setInterval(function(){e.lamps[i].texture=RES.getRes("main_slot_json.orangeLamp"),i=(i+1)%6,e.lamps[i].texture=RES.getRes("main_slot_json.yellowLamp")},t)},e.prototype.plusBet=function(){this.betIndex<12&&(Lobby.ins.user.gold>=this.betArr[this.betIndex+1]?(this.betIndex++,this.bet=this.betArr[this.betIndex],this.betTF.text=this.bet.toString()):Lobby.ins.user.goldNotEnough())},e.prototype.minusBet=function(){this.betIndex>0?(this.betIndex--,this.bet=this.betArr[this.betIndex],this.betTF.text=this.bet.toString()):console.error("最小筹码")},e.prototype.changeGoldTFShow=function(t,e){this.changeGoldTF.text=t,this.changeGoldTF.alpha=0;var i=egret.Tween.get(this.changeGoldTF);this.goldTF.text=e?(+this.goldTF.text-this.bet).toString():Lobby.ins.user.gold.toString(),i.to({alpha:1},100).wait(1500).to({alpha:0},500)},e.prototype.goHandler=function(){var t=this,e=function(){t.goBtn.texture=RES.getRes("main_slot_json.goBtn2"),t.stage.removeEventListener(egret.TouchEvent.TOUCH_END,e,t)};if(!SoltGame.isPlaying)if(Lobby.ins.user.gold>=this.bet){Sound.ins.allow&&Sound.ins.ai.play(0,1),SoltGame.isPlaying=!0,this.changeGoldTFShow("- "+this.bet,!0);var i=SoltGame.soltMachine(this.bet),n=i[0],s=i[1];this.run(n),this.rate=s,this.goBtn.texture=RES.getRes("main_slot_json.goBtn1"),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,e,this)}else Lobby.ins.user.goldNotEnough()},e.prototype.plusBetHandler=function(){var t=this;if(!SoltGame.isPlaying){Sound.ins.allow&&Sound.ins.ai.play(0,1),this.plusBetBtn.texture=RES.getRes("main_slot_json.plusBet1"),this.plusBet();var e=function(){t.plusBetBtn.texture=RES.getRes("main_slot_json.plusBet0"),t.stage.removeEventListener(egret.TouchEvent.TOUCH_END,e,t)};this.stage.addEventListener(egret.TouchEvent.TOUCH_END,e,this)}},e.prototype.minusBetHandler=function(){var t=this;if(!SoltGame.isPlaying){Sound.ins.allow&&Sound.ins.ai.play(0,1),this.minusBetBtn.texture=RES.getRes("main_slot_json.minusBet1"),this.minusBet();var e=function(){t.minusBetBtn.texture=RES.getRes("main_slot_json.minusBet0"),t.stage.removeEventListener(egret.TouchEvent.TOUCH_END,e,t)};this.stage.addEventListener(egret.TouchEvent.TOUCH_END,e,this)}},e}(egret.DisplayObjectContainer);__reflect(SoltMainView.prototype,"SoltMainView");var SoltReel=function(t){function e(e){var i=t.call(this)||this;return i.data=[],i.mainView=e,i.init(),i}return __extends(e,t),e.prototype.init=function(){var t=new egret.Rectangle(0,-38,171,210);this.mask=t,this.fruitGroup=new SoltFruitGroup(this.mainView),this.addChild(this.fruitGroup)},e.prototype.run=function(t,e){this.fruitGroup.run(t,e)},e}(egret.DisplayObjectContainer);__reflect(SoltReel.prototype,"SoltReel");var SuslikGame=function(){function t(){}return t.dealHit=function(t){void 0===t&&(t=10);var e=Utils.getRandomIndexByWeights(this.weights),i=this.rates[e]*t;return Lobby.ins.user.changeGold(t,i),i},t}();SuslikGame.weights=[500,100,50,10,5,5,4,3,2,2,2,2,1,1,1],SuslikGame.rates=[0,1,2,3,4,5,6,7,8,9,10,20,30,40,50],__reflect(SuslikGame.prototype,"SuslikGame");var SuslikHole=function(t){function e(e){var i=t.call(this)||this;return i.inAnime=!1,i.timerArr=[],i.type=null,i.weights=[300,100,50,10,5,5,4,4,4,3,3,2,1,1,1],i.rates=[0,1,2,3,4,5,6,7,8,9,10,20,30,40,50],i.map=e,i.init(),i}return __extends(e,t),e.prototype.init=function(){var t=new egret.Bitmap;t.texture=RES.getRes("main_json.dong"+this.map.name),this.addChild(t),this.suslik=new egret.Bitmap,this.suslik.x=26,this.holeBottom=new egret.Bitmap,this.holeBottom.texture=RES.getRes("main_json.dongtop"+this.map.name),this.addChild(this.holeBottom)},e.prototype.appearSuslik=function(t,e){var i=this;if(void 0===t&&(t=1e3),void 0===e&&(e="1"),null===this.type&&!this.inAnime){this.appearAnime(e),this.resetTimer();var n=setTimeout(function(){i.escapeSulick()},t);this.timerArr.push(n)}},e.prototype.appearAnime=function(t){var e=this;this.suslik.y=-49,this.type=t,this.suslik.texture=RES.getRes("main_json.shu"+t+"a"),this.addChild(this.suslik),this.swapChildren(this.suslik,this.holeBottom);
var i=egret.Tween.get(this.suslik);i.to({y:-69},400,egret.Ease.backOut).call(function(){e.inAnime=!1})},e.prototype.hitSulick=function(t){if(void 0===t&&(t=10),null!==this.type&&!this.inAnime){this.resetTimer(),this.hammerAnime();var e=SuslikGame.dealHit(t);this.hitRword(e,t)}},e.prototype.escapeSulick=function(){var t=this;if(null!==this.type&&!this.inAnime){this.resetTimer(),this.inAnime=!0;var e=egret.Tween.get(this.suslik);e.to({y:-49},300,egret.Ease.backIn).call(function(){t.removeChild(t.suslik),t.type=null,t.inAnime=!1})}},e.prototype.hammerAnime=function(){var t=this;this.inAnime=!0;var e=new egret.Bitmap,i=new egret.Bitmap;i.texture=RES.getRes("main_json.cui"),i.y=20,i.x=180,i.anchorOffsetX=100,i.anchorOffsetY=100,i.rotation=20,this.addChild(i);var n=egret.Tween.get(i);n.to({rotation:-20},150).to({rotation:20},150).to({rotation:-20},150).call(function(){t.removeChild(i)}),this.suslik.texture=RES.getRes("main_json.shu"+this.type+"b");var s=egret.Tween.get(this.suslik);s.to({y:-49},100).call(function(){e.y=-60,e.x=25,e.texture=RES.getRes("main_json.star01"),t.addChild(e)}).wait(100).call(function(){return e.texture=RES.getRes("main_json.star02")}).wait(100).call(function(){return e.texture=RES.getRes("main_json.star03")}).wait(100).call(function(){return e.texture=RES.getRes("main_json.star04")}).wait(100).call(function(){return e.texture=RES.getRes("main_json.star05")}).wait(100).call(function(){return e.texture=RES.getRes("main_json.star06")}).wait(100).call(function(){t.suslik.parent&&t.removeChild(t.suslik),t.removeChild(e),t.type=null,t.inAnime=!1})},e.prototype.hitRword=function(t,e){void 0===e&&(e=10),this.map.hitGold(e),0!==t&&(this.goldAnime(t,e),this.goldTFAnime(t))},e.prototype.goldAnime=function(t,e){for(var i=this,n=function(t){var e=new egret.Bitmap;e.texture=RES.getRes("main_json.gold"),e.width*=1.5,e.height*=1.5;var n=Utils.randomInt(-50,0),o=Utils.randomInt(22,122);e.y=n,e.x=o,s.addChild(e);var r=egret.Tween.get(e);r.wait(400).to({y:n-10},300).to({y:n},300).to({x:-s.x+300,y:-s.y+1e3},200).call(function(){i.removeChild(e),i.map.changeGold()})},s=this,o=0;+t>o;o+=e)n(o)},e.prototype.goldTFAnime=function(t){var e=this,i=new egret.BitmapText,n=RES.getRes("gold_number_fnt");i.font=n,i.text=t.toString(),i.width=360,i.anchorOffsetX=180,i.anchorOffsetY=27,i.textAlign=egret.HorizontalAlign.CENTER,i.x=85,i.y=-15,i.scaleX=.1,i.scaleY=.1,this.addChild(i);var s=egret.Tween.get(i);s.wait(200).to({scaleX:1,scaleY:1},100).wait(400).to({scaleX:.1,scaleY:.1},100).call(function(){return e.removeChild(i)})},e.prototype.resetTimer=function(){this.timerArr.forEach(function(t){clearTimeout(t)}),this.timerArr=[]},e}(egret.DisplayObjectContainer);__reflect(SuslikHole.prototype,"SuslikHole");var SuslikMap=function(t){function e(){var e=t.call(this)||this;return e.holes={},e.hit=0,e.escape=0,e.name="0",e.multiplying=10,e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=this,e=new egret.Bitmap;e.texture=RES.getRes("bg_json.mapbg"+this.name),e.width=ConstantData.CONTENT_WIDTH,e.height=ConstantData.CONTENT_HEIGHT,e.touchEnabled=!0,this.addChild(e);var i=new egret.Bitmap;i.texture=RES.getRes("main_json.back"),i.x=20,i.y=20,this.addChild(i),i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Lobby.ins.back(t)},this);for(var n=function(e){for(var i=function(i){var n=new SuslikHole(s);n.y=300+230*e,n.x=80+200*i,s.holes[e+"_"+i]=n,s.addChild(n);var o=new egret.Shape;o.graphics.beginFill(0,0),o.graphics.drawRect(n.x,n.y-30,173,110),o.graphics.endFill(),o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.tapYX(e,i)},o),s.addChild(o)},n=0;3>n;n++)i(n)},s=this,o=0;3>o;o++)n(o);var r=new egret.Bitmap;r.texture=RES.getRes("main_json.gold"),r.x=300,r.y=1e3,this.addChild(r),this.goldTF=new egret.TextField,this.goldTF.x=340,this.goldTF.y=1001,this.goldTF.textColor=0,this.addChild(this.goldTF),this.changeGold(),this.autoTimeList()},e.prototype.test=function(){var t=this;setInterval(function(){var e=Utils.randomInt(0,2),i=Utils.randomInt(0,2),n=t.getHoleByYX(i,e);n.hitSulick(t.multiplying)},200)},e.prototype.getHoleByYX=function(t,e){return this.holes[t+"_"+e]},e.prototype.tapYX=function(t,e){var i=this.getHoleByYX(t,e);Lobby.ins.user.gold>=this.multiplying&&+this.goldTF.text>=this.multiplying?i.hitSulick(this.multiplying):Lobby.ins.user.goldNotEnough()},e.prototype.changeGold=function(){this.goldTF.text=Lobby.ins.user.gold.toString()},e.prototype.hitGold=function(t){this.goldTF.text=(+this.goldTF.text-t).toString()},e.prototype.randomAppear=function(){for(var t=Utils.getRandomIndexByWeights([30,30,20,10,5,5])+1,e=0;t>e;e++){var i=Utils.randomInt(0,2)+"_"+Utils.randomInt(0,2),n=this.holes[i],s=Utils.randomInt(3e3,6e3),o=Utils.getRandomItemByArray(["1","2","3","4","5"]);n.appearSuslik(s,o)}},e.prototype.autoTimeList=function(){var t=this,e=function(i){setTimeout(function(){t.randomAppear(),e(Utils.randomInt(500,1e3))},i)};e(500)},e}(egret.DisplayObjectContainer);__reflect(SuslikMap.prototype,"SuslikMap");var User=function(){function t(t){this._gold=t}return Object.defineProperty(t.prototype,"gold",{get:function(){return this._gold},enumerable:!0,configurable:!0}),t.prototype.changeGold=function(t,e){void 0===e&&(e=0),this._gold=this._gold-t+e},t.prototype.goldNotEnough=function(){console.error("金币不足")},t}();__reflect(User.prototype,"User");