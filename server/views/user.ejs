<% var session = session || {} %>
<% var user = session.user || null %>
<% var sign = session.sign || "你还没有个性签名，点此修改哦？！" %>

<!DOCTYPE html>
<html>
<head>
  <%- include('head'); %>
  <link rel="stylesheet" href="/css/user.css">
</head>
<body>
  <%- include('header') %>
  <% if (user) { %>
    <div id='user'>
        <h2 class="user-head">用户中心</h2>
        <div class="user-body">
          <p>
            <span class="user-account"><%= user.account %></span>
            <span class="user-uid">uid: <span><%= user.uid %></span></span>
            <span class="user-btn" id="user-logoff">注销</span>
          </p>
          <p>注册时间： <span><%= new Date(user.registerTime).toLocaleString() %></span></p>
          <p>
            个性签名：
            <span id="user-sign-span"><%= sign %></span>
            <input id="user-sign-input" type="text" maxlength="30" value="<%= user.sign %>"/>
          </p>
        </div>
    </div>
    <script src="js/common/jquery-3.1.1.min.js"></script>
    <script>
      $('#user-logoff').on('click',function(){
        $.get('ajax/logoff',function(){
          window.location.pathname = 'login'
        })
      })
      $('#user-sign-span').on('click',function(){
        $(this).hide().next().show().val($(this).text()).focus().select()
      })
      $('#user-sign-input').on('keydown', function(e){
        if (e.keyCode == 13) $(this).blur()
      })
      $('#user-sign-input').on('blur', function(e){
        var val = $(this).val().trim()
        if (val !== ''){
          $(this).hide().prev().show().text(val)
          $.post('ajax/changeSign',{sign: val})
        } else {
          $(this).hide().prev().show().text('修改失败，请输入非空签名！')
        }
      })
    </script>
  <% } else { %>
    <div>
      喵，你进入了一个神秘的领域。
    </div>
  <% } %>






</body>
</html>